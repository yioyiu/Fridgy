# 🚀 智谱AI + DeepSeek AI 双重智能分析

## 📋 **功能概述**

现在AI储藏分析功能支持**多AI平台**，按优先级自动调用：

### 🎯 **调用优先级**
1. **智谱AI** (第一优先级) - 更准确的中文理解
2. **DeepSeek AI** (第二优先级) - 备用AI引擎  
3. **本地分析** (最后备选) - 离线智能分析

### ⚡ **智能降级机制**
```
用户点击物品卡片
        ↓
尝试调用智谱AI
        ↓
├─ 成功 → 返回智谱AI结果
├─ 失败 → 尝试DeepSeek AI
        ↓
        ├─ 成功 → 返回DeepSeek AI结果
        └─ 失败 → 返回本地分析结果
```

## 🔧 **环境配置**

### 1. **智谱AI API密钥配置**

#### 获取智谱AI API密钥：
1. 访问 [智谱AI开放平台](https://open.bigmodel.cn/)
2. 注册账号并登录
3. 进入控制台 → API管理
4. 创建新的API密钥
5. 复制生成的API密钥

#### 配置环境变量：
在 `.env` 文件中添加您的智谱AI API密钥：

```env
# 智谱AI配置 (优先级1)
EXPO_PUBLIC_ZHIPU_API_KEY=您的智谱AI_API密钥

# DeepSeek AI配置 (优先级2) 
EXPO_PUBLIC_DEEPSEEK_API_KEY=您的DeepSeek_API密钥
```

### 2. **API密钥格式说明**

- **智谱AI密钥**：通常格式较长，包含字母数字组合
- **DeepSeek密钥**：通常以 `sk-` 开头

### 3. **配置文件位置**
- **主配置文件**：`d:\App_project\Fridgy\.env`
- **示例文件**：`d:\App_project\Fridgy\.env.example`

## 🎨 **新增功能特点**

### ✨ **智能来源显示**
- 界面会显示分析结果的来源
- "数据来源：智谱AI" / "DeepSeek AI" / "本地分析"
- 用户可以清楚知道结果的可靠性

### 🔄 **无缝切换**
- API调用失败时自动降级
- 用户体验不受影响
- 确保功能始终可用

### 📊 **详细日志**
开发模式下控制台输出：
- 当前尝试的AI平台
- API调用成功/失败状态
- 降级过程信息

## 🏗️ **技术架构**

### 📁 **新增文件**
1. **`src/services/ai/zhipu.ts`** - 智谱AI服务
2. **`src/services/ai/aiManager.ts`** - AI管理器（统一调度）

### 🔄 **修改文件**
1. **`src/components/ai/AIAnalysisModal.tsx`** - 增加来源显示
2. **`.env`** - 添加智谱AI配置项

### 🎯 **核心逻辑**
- **AIManager**: 统一管理多个AI服务
- **优先级调用**: 自动按优先级尝试不同AI
- **错误处理**: 完善的降级和异常处理

## 💡 **使用指南**

### 🚀 **完整配置**（推荐）
配置智谱AI和DeepSeek AI双重保障：
1. 获取两个平台的API密钥
2. 都配置到`.env`文件中
3. 享受最高质量的AI分析

### ⚡ **快速开始**（最低配置）
只配置智谱AI：
1. 获取智谱AI API密钥
2. 配置到`.env`文件中
3. DeepSeek和本地分析作为备选

### 🔒 **离线模式**
不配置任何API密钥：
- 系统会直接使用本地分析
- 仍然提供准确的储藏建议
- 响应速度最快

## 📈 **API成本说明**

### 智谱AI定价：
- GLM-4模型调用费用
- 按token计费
- 具体价格请参考官方文档

### DeepSeek定价：
- deepseek-chat模型费用
- 相对较低的调用成本

### 建议：
- 大部分请求会由智谱AI处理
- DeepSeek作为可靠备选
- 本地分析完全免费

## 🛠️ **故障排除**

### 常见问题：

1. **智谱AI调用失败**
   - 检查API密钥格式
   - 确认账户余额
   - 查看网络连接

2. **DeepSeek AI调用失败** 
   - 同上述检查步骤
   - 查看402错误（余额问题）

3. **完全无法访问AI**
   - 系统会自动降级到本地分析
   - 功能仍然正常工作

### 调试信息：
控制台会显示详细的调用过程，便于排查问题。

## 🎉 **立即体验**

配置完成后：
1. 重启应用
2. 进入Overview页面  
3. 点击任意物品卡片
4. 查看AI分析结果和来源标识

现在您拥有了业界最强的AI储藏分析能力！🎯